Re-writing in Lua.^H^H^H^HC.^H/Vala.

See the HACKING file.
