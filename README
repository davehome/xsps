Re-writing in Lua.^B^B^B^BC++.

See the HACKING file.
